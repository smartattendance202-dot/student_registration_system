# دليل إعداد WhatsApp لإرسال رسائل التحقق

## 📱 ما هو WhatsApp Business API؟

WhatsApp Business API يتيح للشركات إرسال رسائل WhatsApp للعملاء بشكل آمن ومعتمد. يمكن استخدامه لإرسال رموز التحقق والإشعارات.

## 🚀 طريقة الإعداد

### Meta WhatsApp Business API

#### 1. إنشاء تطبيق Facebook
1. **اذهب إلى**: [https://developers.facebook.com/](https://developers.facebook.com/)
2. **أنشئ تطبيق جديد**: اختر "Business"
3. **أضف WhatsApp**: من قائمة المنتجات

#### 2. الحصول على البيانات
1. **Phone Number ID**: من إعدادات WhatsApp
2. **Access Token**: من إعدادات التطبيق
3. **Webhook**: لاستقبال الردود (اختياري)

#### 3. إعداد النظام
```bash
# في ملف .env
WHATSAPP_ACCESS_TOKEN=your_access_token_here
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id_here
WHATSAPP_ENABLED=True
```

## 🇾🇪 دعم الأرقام اليمنية

### الشبكات المدعومة:
- ✅ **يمن موبايل**: 70x, 71x, 72x, 74x, 75x, 76x, 79x
- ✅ **سبائفون**: 73x, 77x  
- ✅ **واي**: 70x, 71x
- ✅ **MTN**: 78x

### أمثلة أرقام صحيحة:
- `712345678` (يمن موبايل)
- `773456789` (سبائفون)
- `778901234` (MTN)
- `770123456` (واي)

### صيغ الإدخال المقبولة:
- ✅ `712345678` (9 أرقام تبدأ بـ 7)
- ✅ `+967712345678` (مع رمز الدولة)
- ✅ `967712345678` (بدون +)
- ❌ `612345678` (لا يبدأ بـ 7)
- ❌ `81234567` (8 أرقام فقط)

## 💰 التكلفة

### Meta WhatsApp Business:
- **الرسائل**: مجانية حتى 1000 رسالة شهرياً
- **بعد ذلك**: حوالي $0.005 لكل رسالة
- **التحقق**: مجاني

## 🔧 اختبار النظام

### 1. وضع التطوير (WHATSAPP_ENABLED=False)
```
============================================================
📱 رمز التحقق عبر WhatsApp لرقم +967712345678
🔢 الرمز: 123456
⏰ صالح لمدة 10 دقائق
💬 سيتم إرسال الرسالة عبر WhatsApp
⚠️  WhatsApp غير مفعل - وضع المحاكاة
============================================================
```

### 2. وضع الإنتاج (WHATSAPP_ENABLED=True)
- سيتم إرسال رسالة WhatsApp حقيقية
- ستظهر رسائل في السجل تؤكد الإرسال
- سيتم خصم تكلفة الرسالة من رصيدك

## 📱 مثال رسالة WhatsApp

```
🔐 رمز التحقق الخاص بك

الرمز: *123456*

⏰ صالح لمدة 10 دقائق
🏫 نظام تسجيل الطلاب

⚠️ لا تشارك هذا الرمز مع أي شخص
```

## 🛠️ استكشاف الأخطاء

### خطأ: "إعدادات WhatsApp غير مكتملة"
**الحل**: تأكد من إدخال جميع القيم في ملف `.env`:
- WHATSAPP_ACCESS_TOKEN
- WHATSAPP_PHONE_NUMBER_ID

### خطأ: "رقم الهاتف غير صالح"
**الحل**: تأكد من أن الرقم يمني ويبدأ بـ 7:
- ✅ صحيح: `712345678`
- ❌ خطأ: `612345678`

### خطأ: "WhatsApp غير متاح لهذا الرقم"
**الحل**:
1. تأكد من أن الرقم يدعم WhatsApp
2. تأكد من أن الرقم مفعل ومؤكد

### خطأ: "فشل في إرسال الرسالة"
**الحل**:
1. تحقق من صحة Access Token
2. تحقق من صحة Phone Number ID
3. تحقق من رصيد الحساب
4. تحقق من حالة الخدمة

## 🔐 الأمان

- **لا تشارك**: Access Token مع أي شخص
- **استخدم HTTPS**: في الإنتاج
- **راقب الاستخدام**: تحقق من استهلاك الرسائل
- **قيد الوصول**: استخدم IP whitelisting

## 🎯 نصائح للاستخدام الأمثل

1. **ابدأ بالاختبار**: في بيئة التطوير
2. **استخدم قوالب معتمدة**: لتجنب الحظر
3. **راقب معدل الإرسال**: لا تتجاوز الحدود
4. **احتفظ بسجلات**: لتتبع الرسائل المرسلة
5. **اختبر مع أرقام حقيقية**: قبل الإطلاق

## 📞 الدعم الفني

### Meta:
- **وثائق**: [https://developers.facebook.com/docs/whatsapp](https://developers.facebook.com/docs/whatsapp)
- **دعم**: [https://developers.facebook.com/support](https://developers.facebook.com/support)

## 🚦 حالة النظام

### ✅ مكتمل:
- دعم جميع الشبكات اليمنية
- تنسيق تلقائي للأرقام
- تكامل مع Twilio WhatsApp
- واجهة سهلة الاستخدام

### 🔄 قيد التطوير:
- قوالب رسائل متقدمة
- تتبع حالة التسليم

### 📋 مخطط مستقبلي:
- دعم رسائل الوسائط
- ردود تلقائية
- تحليلات مفصلة

---

**ملاحظة**: هذا الدليل محدث حسب أحدث إصدارات WhatsApp Business API في 2024.
